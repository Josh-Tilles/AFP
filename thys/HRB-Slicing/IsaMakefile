## configurables

SESSION-NAME = HRB-Slicing
BASE-IMAGE = Jinja

## targets

default: $(SESSION-NAME)
test: $(SESSION-NAME)-test
# usually empty:
images:  $(SESSION-NAME)

all: images


## global settings

SRC = $(ISABELLE_HOME)/src
OUT = $(ISABELLE_OUTPUT)
LOG = $(OUT)/log

# turn image into absolute path according to ISABELLE_IMAGE_PATH or OUT
ifeq ($(ISABELLE_IMAGE_PATH),)
IMAGE=$(OUT)/$(BASE-IMAGE)
else
IMAGE=$(ISABELLE_IMAGE_PATH)$(BASE-IMAGE)
endif

DOCFLAGS = -v true -i true -V outline=/proof,/ML -g true -d pdf
USEDIR = $(ISABELLE_TOOL) usedir  $(DOCFLAGS)
BUILD = $(ISABELLE_TOOL) usedir -b $(DOCFLAGS)
BUILD_PART = $(ISABELLE_TOOL) usedir -b -v true -i false -g false -d false

# time limit (in sec)
MAXTIME = 5400


## dependencies

Jinja:
	cd ../Jinja; $(ISABELLE_TOOL) make Jinja

# test run and proof document

$(SESSION-NAME)-test: Jinja $(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz

$(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz: $(OUT)/Jinja ROOT.ML HRBSlicing.thy \
  StaticInter/*.thy Proc/*.thy JinjaVM_Inter/*.thy \
  document/root.tex 
	cd ..; ulimit -t $(MAXTIME); $(USEDIR) Jinja $(SESSION-NAME)


# build image

HRB-Slicing: $(OUT)/HRB-Slicing

$(OUT)/HRB-Slicing: $(OUT)/Jinja ROOT.ML HRBSlicing.thy \
  StaticInter/*.thy Proc/*.thy JinjaVM_Inter/*.thy \
  document/root.tex 
	ulimit -t $(MAXTIME); $(BUILD) Jinja $(SESSION-NAME)



## clean

clean:
	@rm -f $(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz
	@rm -f $(OUT)/$(SESSION-NAME)

