## configurables

SESSION-NAME = LinearQuantifierElim
BASE-IMAGE = HOL-Complex

## targets

default: $(SESSION-NAME)
test: $(SESSION-NAME) images
images:  $(SESSION-NAME)-build

all: test


## global settings

SRC = $(ISABELLE_HOME)/src
OUT = $(ISABELLE_OUTPUT)
LOG = $(OUT)/log

# turn image into absolute path according to ISABELLE_IMAGE_PATH or OUT
ifeq ($(ISABELLE_IMAGE_PATH),)
IMAGE=$(OUT)/$(BASE-IMAGE)
else
IMAGE=$(ISABELLE_IMAGE_PATH)$(BASE-IMAGE)
endif


USEDIR = $(ISATOOL) usedir -v true -i true -V outline=/proof,/ML -d pdf -P "http://isabelle.in.tum.de/library/"
BUILD = $(ISATOOL) usedir -b -v true -i false -g false -d false

# time limit (in sec)
MAXTIME = 600


## dependencies

$(SESSION-NAME): $(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz

$(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz: $(IMAGE) ROOT.ML Thys/*.thy document/*.tex document/*.bib
	cd ..; ulimit -t $(MAXTIME); $(USEDIR) $(IMAGE) $(SESSION-NAME)


$(SESSION-NAME)-build: $(LOG)/$(BASE-IMAGE)-$(SESSION-NAME)-build.gz

$(LOG)/$(BASE-IMAGE)-$(SESSION-NAME)-build.gz: $(IMAGE) ROOT.ML Thys/*.thy
	ulimit -t $(MAXTIME); $(BUILD) -f ROOT.ML $(IMAGE) $(SESSION-NAME)


## clean

clean:
	@rm -f $(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz $(LOG)/$(BASE-IMAGE)-$(SESSION-NAME)-build.gz
