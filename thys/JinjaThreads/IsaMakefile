## configurables

SESSION-NAME = JinjaThreads
BASE-IMAGE = HOL-Word

## targets

default: $(SESSION-NAME)
test: $(SESSION-NAME)
# usually empty:
images:

all: $(SESSION-NAME)

## global settings

SRC = $(ISABELLE_HOME)/src
OUT = $(ISABELLE_OUTPUT)
LOG = $(OUT)/log


# turn image into absolute path according to ISABELLE_IMAGE_PATH or OUT
ifeq ($(ISABELLE_IMAGE_PATH),)
IMAGE=$(OUT)/$(BASE-IMAGE)
else
IMAGE=$(ISABELLE_IMAGE_PATH)$(BASE-IMAGE)
endif

USEDIR = $(ISABELLE_TOOL) usedir -v true -i true -g true -d pdf -V outline=/proof,/ML

## dependencies

# test run and proof document

$(SESSION-NAME): HOL-Word $(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz

HOL-Word: 
	cd $(ISABELLE_HOME)/src/HOL; $(ISABELLE_TOOL) make HOL-Word

$(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz: $(IMAGE) ROOT.ML Common/*.thy J/*.thy Framework/*.thy document/*.tex BV/*.thy JVM/*.thy Compiler/*.thy MM/*.thy DFA/*.thy ../Jinja/DFA/*.thy ../Coinductive/*.thy ../FinFun/*.thy
	cd ..; $(USEDIR) $(IMAGE) $(SESSION-NAME)

## clean

clean:
	@rm -f $(LOG)/$(BASE-IMAGE)-$(SESSION-NAME).gz
	@rm -f $(OUT)/$(SESSION-NAME)